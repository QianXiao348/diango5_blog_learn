{% extends 'base.html' %}
{% load static %} {# 确保加载 static 标签 #}

{% block title %}登录博客{% endblock %}

{% block head %}
    {# 确保 jQuery 在 login.js 之前加载 #}
    <script src="{% static 'jquery/jquery-3.7.1.min.js' %}"></script>
{% endblock %}

{% block main %}
    <div style="max-width: 330px;" class="mx-auto">
        <h1>登录</h1>
        <form id="login-form" action="{% url 'qxauth:login' %}" method="post">
            {% csrf_token %}

            {# 通用错误信息显示区域，默认隐藏。当网络错误或后端返回message时使用 #}
            <div id="form-general-message" class="alert alert-danger" style="display: none; margin-bottom: 10px;"></div>

            <div class="mb-3">
                <label>邮箱</label>
                <input type="email" name="email" class="form-control" placeholder="请输入邮箱">
                {# 字段特定错误显示区域 #}
                <div id="error-email" class="text-danger small" style="display: none;"></div>
            </div>
            <div class="mb-3">
                <label>密码</label>
                <input type="password" name="password" class="form-control" placeholder="请输入密码">
                <div id="error-password" class="text-danger small" style="display: none;"></div>
            </div>
            <div class="form-check mb-3">
                <input class="form-check-input" type="checkbox" name='remember' value="1" id="checkDefault">
                <label class="form-check-label" for="checkDefault">
                    记住我
                </label>
                <small class="form-text text-muted d-block text-end">
                    <a class="secondaryAction" href="{% url 'qxauth:password_reset' %}">忘记密码?</a>
                </small>
            </div>
            {# 非字段错误（例如“邮箱或密码不正确！”）显示区域 #}
            <div id="error-__all__" class="alert alert-danger small" style="display: none;"></div>

            <div class="mb-3">
                {# !! 按钮类型改为 submit，以便 form.submit() 事件能捕获 !! #}
                <button class="btn btn-success w-100" type="submit">
                    立即登录
                </button>
            </div>
        </form>
    </div>

    {# 将JS放在这里，确保DOM加载完成 #}
    <script src="{% static 'js/login.js' %}"></script>
{% endblock %}